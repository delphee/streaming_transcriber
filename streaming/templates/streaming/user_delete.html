{% extends 'streaming/base.html' %}

{% block title %}Delete User - Conversation Intelligence Platform{% endblock %}

{% block extra_css %}
<style>
    .page-header {
        background: linear-gradient(135deg, var(--danger-color) 0%, #8e0000 100%);
        color: white;
        padding: 2rem;
        border-radius: 8px;
        margin-bottom: 2rem;
    }
    
    .page-header h1 {
        margin: 0;
        font-weight: 600;
        font-size: 1.8rem;
    }
    
    .page-header p {
        margin: 0.5rem 0 0;
        opacity: 0.9;
    }
    
    .warning-card {
        background: white;
        border-radius: 8px;
        padding: 2rem;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        margin-bottom: 2rem;
        border-left: 6px solid var(--danger-color);
    }
    
    .warning-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid var(--light-bg);
    }
    
    .warning-icon {
        width: 60px;
        height: 60px;
        background: rgba(198, 40, 40, 0.1);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--danger-color);
        font-size: 2rem;
    }
    
    .warning-content h2 {
        margin: 0;
        color: var(--danger-color);
        font-weight: 600;
        font-size: 1.4rem;
    }
    
    .warning-content p {
        margin: 0.25rem 0 0;
        color: var(--secondary-color);
    }
    
    .user-details {
        background: var(--light-bg);
        border-radius: 6px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }
    
    .user-details h3 {
        font-size: 1.1rem;
        font-weight: 600;
        color: #333;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .user-details h3 i {
        color: var(--primary-color);
    }
    
    .detail-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
    }
    
    .detail-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--secondary-color);
        font-size: 0.95rem;
    }
    
    .detail-item i {
        color: var(--primary-color);
        font-size: 1.1rem;
    }
    
    .detail-item strong {
        color: #333;
    }
    
    .impact-section {
        margin-bottom: 1.5rem;
    }
    
    .impact-section h4 {
        font-size: 1rem;
        font-weight: 600;
        color: #333;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .impact-section h4 i {
        color: var(--warning-color);
    }
    
    .impact-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .impact-list li {
        padding: 0.75rem;
        background: rgba(245, 124, 0, 0.05);
        border-left: 3px solid var(--warning-color);
        margin-bottom: 0.5rem;
        border-radius: 0 4px 4px 0;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: #333;
    }
    
    .impact-list li i {
        color: var(--warning-color);
    }
    
    .confirmation-box {
        background: rgba(198, 40, 40, 0.05);
        border: 2px solid var(--danger-color);
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }
    
    .confirmation-box h4 {
        color: var(--danger-color);
        font-weight: 600;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .confirmation-box h4 i {
        font-size: 1.3rem;
    }
    
    .confirmation-text {
        color: #333;
        line-height: 1.6;
        margin-bottom: 0;
    }
    
    .form-actions {
        display: flex;
        gap: 1rem;
        padding-top: 1.5rem;
        border-top: 2px solid var(--light-bg);
    }
    
    .btn-danger {
        padding: 0.75rem 2rem;
        font-weight: 600;
        background-color: var(--danger-color);
        border-color: var(--danger-color);
    }
    
    .btn-danger:hover {
        background-color: #8e0000;
        border-color: #8e0000;
        transform: none;
    }
    
    .btn-outline-secondary {
        padding: 0.75rem 2rem;
        font-weight: 600;
    }
    
    .no-impact {
        color: var(--success-color);
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .no-impact i {
        font-size: 1.2rem;
    }
</style>
{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header">
    <h1><i class="bi bi-exclamation-triangle-fill me-2"></i>Delete User</h1>
    <p>This action cannot be undone. Please review carefully before proceeding.</p>
</div>

<!-- Warning Card -->
<div class="warning-card">
    <div class="warning-header">
        <div class="warning-icon">
            <i class="bi bi-trash-fill"></i>
        </div>
        <div class="warning-content">
            <h2>Permanent Deletion Warning</h2>
            <p>You are about to permanently delete this user account</p>
        </div>
    </div>
    
    <!-- User Details -->
    <div class="user-details">
        <h3>
            <i class="bi bi-person-circle"></i>
            User Information
        </h3>
        
        <div class="detail-grid">
            <div class="detail-item">
                <i class="bi bi-at"></i>
                <span><strong>Username:</strong> {{ user_to_delete.username }}</span>
            </div>
            
            <div class="detail-item">
                <i class="bi bi-envelope"></i>
                <span><strong>Email:</strong> {{ user_to_delete.email }}</span>
            </div>
            
            <div class="detail-item">
                <i class="bi bi-person"></i>
                <span><strong>Name:</strong> {{ user_to_delete.get_full_name|default:"Not provided" }}</span>
            </div>
            
            <div class="detail-item">
                <i class="bi bi-calendar3"></i>
                <span><strong>Joined:</strong> {{ user_to_delete.date_joined|date:"M d, Y" }}</span>
            </div>
            
            <div class="detail-item">
                <i class="bi bi-shield-check"></i>
                <span><strong>Role:</strong> {% if user_to_delete.is_staff %}Administrator{% else %}User{% endif %}</span>
            </div>
            
            <div class="detail-item">
                <i class="bi bi-activity"></i>
                <span><strong>Status:</strong> {% if user_to_delete.is_active %}Active{% else %}Inactive{% endif %}</span>
            </div>
        </div>
    </div>
    
    <!-- Impact Assessment -->
    <div class="impact-section">
        <h4>
            <i class="bi bi-exclamation-circle-fill"></i>
            Impact Assessment
        </h4>
        
        {% if user_to_delete.conversations.count > 0 %}
        <ul class="impact-list">
            <li>
                <i class="bi bi-chat-left-text-fill"></i>
                <strong>{{ user_to_delete.conversations.count }} conversation{{ user_to_delete.conversations.count|pluralize }}</strong> 
                will remain in the system but will be marked as "deleted user"
            </li>
            
            {% if user_to_delete.auth_tokens.count > 0 %}
            <li>
                <i class="bi bi-key-fill"></i>
                <strong>{{ user_to_delete.auth_tokens.count }} authentication token{{ user_to_delete.auth_tokens.count|pluralize }}</strong> 
                will be invalidated immediately
            </li>
            {% endif %}
            
            <li>
                <i class="bi bi-person-x-fill"></i>
                User will be <strong>immediately logged out</strong> from all devices (web and iOS)
            </li>
            
            <li>
                <i class="bi bi-database-fill-x"></i>
                User profile and settings will be <strong>permanently deleted</strong>
            </li>
        </ul>
        {% else %}
        <div class="no-impact">
            <i class="bi bi-check-circle-fill"></i>
            <span>This user has no conversations. Deletion will have minimal impact.</span>
        </div>
        {% endif %}
    </div>
    
    <!-- Confirmation Box -->
    <div class="confirmation-box">
        <h4>
            <i class="bi bi-shield-exclamation"></i>
            Confirm Deletion
        </h4>
        <p class="confirmation-text">
            Are you absolutely sure you want to delete 
            <strong>{{ user_to_delete.get_full_name|default:user_to_delete.username }}</strong> 
            ({{ user_to_delete.email }})?
            This action is <strong>irreversible</strong> and the user account cannot be recovered.
        </p>
    </div>
    
    <!-- Form Actions -->
    <form method="POST" action="{% url 'user_delete' user_to_delete.id %}" onsubmit="return confirm('FINAL CONFIRMATION: Are you absolutely certain you want to delete this user? This cannot be undone.');">
        {% csrf_token %}
        <div class="form-actions">
            <button type="submit" class="btn btn-danger">
                <i class="bi bi-trash-fill me-2"></i>
                Yes, Permanently Delete User
            </button>
            <a href="{% url 'user_management' %}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left me-2"></i>
                Cancel - Keep User
            </a>
        </div>
    </form>
</div>
{% endblock %}